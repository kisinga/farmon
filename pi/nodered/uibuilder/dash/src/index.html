<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farm Monitor</title>

    <!-- Tailwind CSS + DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.6.0/dist/full.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Vue 3 -->
    <script src="../uibuilder/vendor/vue/dist/vue.global.prod.js"></script>

    <!-- ECharts + vue-echarts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-liquidfill@3.1.0/dist/echarts-liquidfill.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-echarts@6.5.0/dist/index.umd.min.js"></script>

    <!-- UI-Builder Client -->
    <script src="../uibuilder/uibuilder.iife.min.js"></script>

    <!-- State Store (must load before components and main app) -->
    <script src="./store/deviceStore.js"></script>

    <style>
       /* prefer using the css file */
    </style>
</head>

<body class="bg-base-300">
    <div id="app" v-cloak>
        <!-- Drawer wrapper for mobile sidebar -->
        <div class="drawer">
            <input id="main-drawer" type="checkbox" class="drawer-toggle" />

            <!-- Main content area -->
            <div class="drawer-content flex flex-col">

                <!-- Navbar -->
                <navbar @set-tab="setTab" />

                <!-- Mobile Tab Navigation -->
                <tab-navigation @set-tab="setTab" />

                <!-- Page Content -->
                <main class="main-content p-2 sm:p-4">
                    <div class="max-w-5xl mx-auto space-y-3">

                        <!-- No Devices Available -->
                        <dashboard-empty-state v-if="devices.length === 0" state="no-devices" />

                        <!-- Device Selector - Always visible when devices exist -->
                        <device-selector v-if="devices.length > 0" 
                                        :show-time-range="activeTab === 'dashboard'"
                                        @select-device="selectDevice"
                                        @time-range-change="onTimeRangeChange" />

                        <!-- Device Content -->
                        <div v-if="devices.length > 0" class="space-y-3">
                            <!-- ======================= DASHBOARD TAB ======================= -->
                            <dashboard-view v-show="activeTab === 'dashboard'"
                                           @navigate-to-controls="setTab('controls')" />

                            <!-- ======================= CONTROLS TAB ======================= -->
                            <controls-view v-show="showControlsPage"
                                          @send-command="sendSystemCommand"
                                          @set-control="setControl"
                                          @clear-override="clearOverride" />

                            <!-- ======================= RULES TAB ======================= -->
                            <rules-view v-show="activeTab === 'rules'"
                                       @add-edge-rule="openEdgeRuleEditor"
                                       @edit-edge-rule="openEdgeRuleEditor"
                                       @delete-edge-rule="deleteEdgeRule"
                                       @toggle-edge-rule="toggleEdgeRule"
                                       @toggle-trigger="toggleTrigger"
                                       @add-rule="openRuleEditor"
                                       @edit-rule="editRule"
                                       @delete-rule="deleteRule"
                                       @toggle-rule="toggleRule" />

                            <!-- ======================= HISTORY TAB ======================= -->
                            <history-view v-show="activeTab === 'history'"
                                         :device-eui="selectedDevice" />
                        </div>

                    </div>
                </main>

                <!-- Rule Editor Modal -->
                <rule-editor-modal v-if="showRuleEditor" @close="closeRuleEditor" @save="saveRule" />

                <!-- Edge Rule Editor Modal -->
                <edge-rule-editor-modal v-if="showEdgeRuleEditor" @close="closeEdgeRuleEditor" @save="saveEdgeRule" />

                <!-- Footer -->
                <footer class="footer footer-center p-4 bg-base-100 text-base-content mt-auto">
                    <p class="text-xs opacity-50">Farm Monitor Dashboard</p>
                </footer>

            </div>

            <!-- Drawer sidebar (mobile) -->
            <sidebar @set-tab="setTab" @select-device="selectDeviceAndClose" />

        </div>
    </div>

    <script type="module" src="./index.js"></script>
</body>

</html>
